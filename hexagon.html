<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Hexagon</title>

    <style>
        path {
            stroke: #000;
            stroke-width: 3px;
            fill: none;
        }
    </style>
</head>
<body>

<script src="https://d3js.org/d3.v5.min.js"></script>
<script>

    class Svg {
        static height = 500;
        static width = 960;
        static svg = d3.select('body').append('svg')
                        .attr('width', this.width)
                        .attr('height', this.height)
                        .attr('overflow', 'hidden');
    }

    class Hexagon {
        // Assumes center is at (0,0)
        points = [];
        // Define how the line between the points should look
        lineFunction = d3.line()
                            .x(function(d) { return d.x; })
                            .y(function(d) {return d.y; });
        path;

        constructor(container, sideLength) {
            this.addPoints(sideLength);
            this.path = container.append("path")
                .attr("d", this.lineFunction(this.points));
        }

        updatePoints(sideLength, opacity) {
            this.points = [];
            this.addPoints(sideLength, opacity);
            this.path.attr("d", this.lineFunction(this.points))
                .attr("stroke-opacity", opacity);
        }

        addPoints(sideLength) {
            const angle = Math.PI/3;
            const yShift = sideLength*Math.sin(angle);

            // Calculate the 6 points
            this.points.push({x: sideLength/2, y: -yShift});
            this.points.push({x: sideLength, y: 0});
            this.points.push({x: sideLength/2, y: yShift});
            this.points.push({x: -sideLength/2, y: yShift});
            this.points.push({x: -sideLength, y: 0});
            this.points.push({x: -sideLength/2, y: -yShift});

            // to close the path nicely
            this.points.push(this.points[0]);
            this.points.push(this.points[1]);
        }
    }

    class Hexagons {
        defaultSideLength;
        hexagons = [];
        offsets = [];
        constructor(container, sideLength, numHexagons) {
            this.defaultSideLength = sideLength;

            const offset = sideLength/numHexagons;
            for(let i = 0; i < numHexagons; i++) {
                this.offsets.push(i*offset);
                this.hexagons.push(new Hexagon(container, sideLength - this.offsets[i]));
            }
        }

        shiftHexagons(elapsed) {
            for(let i = 0; i < this.hexagons.length; i++) {
                let shift = (elapsed + this.offsets[i]) % this.defaultSideLength;
                let currSideLength = this.defaultSideLength - shift;
                this.hexagons[i].updatePoints(currSideLength, 1 - currSideLength/this.defaultSideLength);
            }
        }
    }

    const translate = 'translate(' + Svg.width/2 + ',' + Svg.height/2 + ')';
    let g = Svg.svg.append('g')
        .attr('transform', translate);

    const sideLength = 200;
    const numHexagons = 5;
    hexagons = new Hexagons(g, sideLength, numHexagons);
    d3.timer(function(elapsed) {
        const factor = 25;
        let shift = elapsed/factor;
        g.attr('transform', translate + 'rotate(' + shift + ')');
        hexagons.shiftHexagons(shift);
    })


</script>

</body>
</html>